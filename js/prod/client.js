function get(e){return t=>r=>(e.methods.subscribe(t,r),e.objects.observables[r])}function subscribe(e){return(t,r)=>{const s=e.objects.listeners.find(e=>e.observable===r);if(!s)return console.log(`Listener not found on observable ${r}`);const a=s.components;a.find(e=>e.registerNumber===t)||a.push({registerNumber:t})}}const isPlainValue=e=>["string","number","boolean"].includes(typeof e),wasChanged=(e,t)=>e!==t,shouldNotify=(e,t)=>!isPlainValue(t)||isPlainValue(t)&&wasChanged(e,t);function set(e){return(t,r={})=>{if(!t)return;const{dynamic:s=!1,timeout:a=0}=r;Object.keys(t).forEach(r=>{const n=e.objects.observables[r],o=Array.isArray(n)?[...n]:"object"==typeof n?{...n}:n,c="function"==typeof t[r]?t[r](o):t[r];typeof n==typeof c||s?shouldNotify(n,c)&&setTimeout(()=>{e.objects.observables[r]=c,e.methods.notify(r)},a):console.warn(`Type does not match previous type in ${r}`)})}}function setItem(e){return(t,r)=>{const s=e.objects.observables[t].findIndex(e=>e.id===r.id);e.objects.observables[t][s]=r,e.methods.notify(t)}}function toggle(e){return(t,r)=>{const s=e.objects.observables[t];void 0===s?console.warn(`Observable [${t}] does not exists.`):"boolean"!=typeof s?console.warn(`Observable [${t}] is not a boolean.`):(e.methods.set({[t]:!s}),r&&r(!s))}}function notify(e){return t=>{t&&Object.keys(e.objects.computed).forEach(r=>{const{take:s}=e.objects.computed[r];s.includes(t)&&e.methods.compute(r)}),e.objects.flags.IS_MOUNTED&&e.render.update()}}function compute(e){return t=>{const{take:r,calc:s}=e.objects.computed[t],a=r.map(t=>e.objects.observables[t]);e.objects.observables[t]=s(...a)}}function computeAll(e){return()=>{Object.keys(e.objects.computed).forEach(t=>{e.methods.compute(t)})}}function emit(e){return(t,r)=>{"MOUNTED"===t&&(e.objects.flags.IS_MOUNTED=!0),e.objects.reactions.filter(e=>e.keepAlive?e.eventStr===t:e.eventStr===t&&!e.done).forEach(e=>{e.done=!0,e.callback(r)})}}function on(e){return(t,r)=>{e.objects.reactions.push({eventStr:t,callback:r,keepAlive:!0})}}function once(e){return(t,r)=>{e.objects.reactions.push({eventStr:t,callback:r,done:!1})}}function check(e,t){return(e,r)=>{const{result:s,message:a}=t[e](r);return{result:s,message:a}}}function alertOn(e,t){return(r={})=>{const s=Math.floor(1e3*Math.random()),a=Date.now(),n=`${a}--${s}`,o=r.name?t[r.name]:r.message||"Alert message not defined";e.objects.alerts.push({_id:n,...r,message:o,timestamp:a,isVisible:!0}),e.methods.notify(null),r.timeout&&setTimeout(()=>{e.methods.alertOff({_id:n})},r.timeout)}}function alertOff(e){return({_id:t})=>{const r=e.objects.alerts.find(e=>e._id===t);r&&(r.isVisible=!1,e.methods.notify(null))}}function callServer(e){return(t,r={})=>new Promise((s,a)=>{const n=new window.XMLHttpRequest;n.open("POST",`${e.router.siteUrl}/api/methods`,!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=(()=>{if(n.readyState===window.XMLHttpRequest.DONE){const e=n.status;if(![200,201].includes(e))return a("XHR request failed");const t=n.responseText;return s(JSON.parse(t))}});const o=JSON.stringify({method:t,args:r});n.send(o)})}function route(e){return(t,r)=>{const{moduleName:s,routes:a,ports:n,isProduction:o,baseUrl:c}=e.router.appData,i=r?`${t}${r}`:t,l=Object.keys(a).reduce((e,r)=>a[r].includes(t)?r:e,!1);if(l&&l===s)window.history.replaceState(null,null,i);else{const e=o?`/${i}`:`https://${c}:${n[l].http}/${i}`;window.location.replace(e)}}}const noop=()=>void 0;function addToQueue(e){return({name:t,steps:r,onError:s})=>{const a=Date.now(),n={_id:a,name:t,steps:r,done:!1,onError:s||noop};e.process.queue.splice(0,0,n),e.process.runTask({_id:a})}}function callProcesses(e,t){if(!t)return()=>void 0;const r={get:t=>e.objects.observables[t],set:e.methods.set,addAlert:e.methods.alertOn,callServer:e.methods.callServer,route:e.router.route,uid:e.utils.uid},s=Object.keys(t).reduce((s,a)=>{const n=t[a];return{...s,[a]:t=>{e.process.addToQueue({name:a,...n(r)(t)})}}},{});return(e,t)=>s[e](t)}function processor(){return({steps:e,onError:t})=>{let r=!0;e.reduce((e,s)=>e.then(e=>{if(r)return s(e)}).catch(e=>{r=!1,console.log("processPromiseChain ERROR -----------------\x3e ",e),t(e)}),Promise.resolve({}))}}function runTask(e){return({_id:t})=>{const r=e.process.queue.find(e=>e._id===t);e.process.processor(r),r.done=!0}}function mount(e){return()=>{const{rootComponent:t,client:r}=e.render,s=t(r)();document.body.innerHTML="",document.body.appendChild(s)}}var range,actualHasAttributeNS,NS_XHTML="http://www.w3.org/1999/xhtml",doc="undefined"==typeof document?void 0:document,testEl=doc?doc.body||doc.createElement("div"):{},hasAttributeNS=actualHasAttributeNS=testEl.hasAttributeNS?function(e,t,r){return e.hasAttributeNS(t,r)}:testEl.hasAttribute?function(e,t,r){return e.hasAttribute(r)}:function(e,t,r){return null!=e.getAttributeNode(t,r)};function toElement(e){var t;return!range&&doc.createRange&&(range=doc.createRange()).selectNode(doc.body),range&&range.createContextualFragment?t=range.createContextualFragment(e):(t=doc.createElement("body")).innerHTML=e,t.childNodes[0]}function compareNodeNames(e,t){var r=e.nodeName,s=t.nodeName;return r===s||!!(t.actualize&&r.charCodeAt(0)<91&&s.charCodeAt(0)>90)&&r===s.toUpperCase()}function createElementNS(e,t){return t&&t!==NS_XHTML?doc.createElementNS(t,e):doc.createElement(e)}function moveChildren(e,t){for(var r=e.firstChild;r;){var s=r.nextSibling;t.appendChild(r),r=s}return t}function morphAttrs(e,t){var r,s,a,n,o,c=t.attributes;for(r=c.length-1;r>=0;--r)a=(s=c[r]).name,n=s.namespaceURI,o=s.value,n?(a=s.localName||a,e.getAttributeNS(n,a)!==o&&e.setAttributeNS(n,a,o)):e.getAttribute(a)!==o&&e.setAttribute(a,o);for(r=(c=e.attributes).length-1;r>=0;--r)!1!==(s=c[r]).specified&&(a=s.name,(n=s.namespaceURI)?(a=s.localName||a,hasAttributeNS(t,n,a)||e.removeAttributeNS(n,a)):hasAttributeNS(t,null,a)||e.removeAttribute(a))}function syncBooleanAttrProp(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r,""))}var specialElHandlers={OPTION:function(e,t){syncBooleanAttrProp(e,t,"selected")},INPUT:function(e,t){syncBooleanAttrProp(e,t,"checked"),syncBooleanAttrProp(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),hasAttributeNS(t,null,"value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var s=e.firstChild;if(s){var a=s.nodeValue;if(a==r||!r&&a==e.placeholder)return;s.nodeValue=r}},SELECT:function(e,t){if(!hasAttributeNS(t,null,"multiple")){for(var r=0,s=t.firstChild;s;){var a=s.nodeName;if(a&&"OPTION"===a.toUpperCase()){if(hasAttributeNS(s,null,"selected"))break;r++}s=s.nextSibling}e.selectedIndex=r}}},ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8;function noop$1(){}function defaultGetNodeKey(e){return e.id}function morphdomFactory(e){return function(t,r,s){if(s||(s={}),"string"==typeof r)if("#document"===t.nodeName||"HTML"===t.nodeName){var a=r;(r=doc.createElement("html")).innerHTML=a}else r=toElement(r);var n,o=s.getNodeKey||defaultGetNodeKey,c=s.onBeforeNodeAdded||noop$1,i=s.onNodeAdded||noop$1,l=s.onBeforeElUpdated||noop$1,u=s.onElUpdated||noop$1,d=s.onBeforeNodeDiscarded||noop$1,p=s.onNodeDiscarded||noop$1,f=s.onBeforeElChildrenUpdated||noop$1,m=!0===s.childrenOnly,h={};function b(e){n?n.push(e):n=[e]}function g(e,t,r){!1!==d(e)&&(t&&t.removeChild(e),p(e),function e(t,r){if(t.nodeType===ELEMENT_NODE)for(var s=t.firstChild;s;){var a=void 0;r&&(a=o(s))?b(a):(p(s),s.firstChild&&e(s,r)),s=s.nextSibling}}(e,r))}function v(e){i(e);for(var t=e.firstChild;t;){var r=t.nextSibling,s=o(t);if(s){var a=h[s];a&&compareNodeNames(t,a)&&(t.parentNode.replaceChild(a,t),y(a,t))}v(t),t=r}}function y(s,a,n){var i,d=o(a);if(d&&delete h[d],!r.isSameNode||!r.isSameNode(t)){if(!n){if(!1===l(s,a))return;if(e(s,a),u(s),!1===f(s,a))return}if("TEXTAREA"!==s.nodeName){var p,m,k,A,S=a.firstChild,w=s.firstChild;e:for(;S;){for(k=S.nextSibling,p=o(S);w;){if(m=w.nextSibling,S.isSameNode&&S.isSameNode(w)){S=k,w=m;continue e}i=o(w);var C=w.nodeType,N=void 0;if(C===S.nodeType&&(C===ELEMENT_NODE?(p?p!==i&&((A=h[p])?w.nextSibling===A?N=!1:(s.insertBefore(A,w),m=w.nextSibling,i?b(i):g(w,s,!0),w=A):N=!1):i&&(N=!1),(N=!1!==N&&compareNodeNames(w,S))&&y(w,S)):C!==TEXT_NODE&&C!=COMMENT_NODE||(N=!0,w.nodeValue!==S.nodeValue&&(w.nodeValue=S.nodeValue))),N){S=k,w=m;continue e}i?b(i):g(w,s,!0),w=m}if(p&&(A=h[p])&&compareNodeNames(A,S))s.appendChild(A),y(A,S);else{var E=c(S);!1!==E&&(E&&(S=E),S.actualize&&(S=S.actualize(s.ownerDocument||doc)),s.appendChild(S),v(S))}S=k,w=m}for(;w;)m=w.nextSibling,(i=o(w))?b(i):g(w,s,!0),w=m}var T=specialElHandlers[s.nodeName];T&&T(s,a)}}!function e(t){if(t.nodeType===ELEMENT_NODE)for(var r=t.firstChild;r;){var s=o(r);s&&(h[s]=r),e(r),r=r.nextSibling}}(t);var k=t,A=k.nodeType,S=r.nodeType;if(!m)if(A===ELEMENT_NODE)S===ELEMENT_NODE?compareNodeNames(t,r)||(p(t),k=moveChildren(t,createElementNS(r.nodeName,r.namespaceURI))):k=r;else if(A===TEXT_NODE||A===COMMENT_NODE){if(S===A)return k.nodeValue!==r.nodeValue&&(k.nodeValue=r.nodeValue),k;k=r}if(k===r)p(t);else if(y(k,r,m),n)for(var w=0,C=n.length;w<C;w++){var N=h[n[w]];N&&g(N,N.parentNode,!1)}return!m&&k!==t&&t.parentNode&&(k.actualize&&(k=k.actualize(t.ownerDocument||doc)),t.parentNode.replaceChild(k,t)),k}}var morphdom=morphdomFactory(morphAttrs),morphdom_1=morphdom;function update(e){return()=>{const{rootComponent:t,client:r,rootNodeId:s,Events:a}=e.render,n=Object.keys(a),o=t(r)(),c=document.getElementById(s);morphdom_1(c,o,{onBeforeElUpdated(e,t){n.forEach(r=>{e[r]&&(e[r]=t[r])})},onBeforeNodeDiscarded(e){if(e.tagName&&"iframe"===e.tagName.toLowerCase())return!1}})}}var globals={SYSTEM_DB_USER_ID:"0000000-system-000000",WINDOW_APP_DATA:"__appData__",GET_MODEL_DATA_METHOD:"@server-model.getData"};function getDataFromServer(e){return t=>{const{instance:r=null,user_id:s,lastTimestamp:a=0,localEntitiesIds:n=[]}=t,o={user_id:s,lastTimestamp:a,localEntitiesIds:n};return new Promise((t,s)=>{e.methods.callServer(globals.GET_MODEL_DATA_METHOD,o).then(e=>{e||s("Could not get data from server");const a=Date.now();t({instance:r,items:e,newTimestamp:a})}).catch(s)})}}function syncDataToDB({instance:e,items:t,newTimestamp:r}){let s=0;return new Promise(a=>{0===t.length&&a({instance:e,counter:s,newTimestamp:r});const n=e.transaction(["model"],"readwrite").objectStore("model"),o=n.getAll();o.onsuccess=(()=>{const c=o.result;t.forEach(o=>{if(o.attrs.length>0){const i=c.find(e=>e._id===o._id);n.put({_id:o._id,domain:o.domain,attrs:i?[...i.attrs,...o.attrs]:o.attrs}).onsuccess=(()=>{++s===t.length&&a({instance:e,counter:s,newTimestamp:r})})}})})})}function getDBMetadata({instance:e,user_id:t}){return new Promise((r,s)=>{const a=e.transaction("control").objectStore("control").getAll();a.onsuccess=(()=>{const n=a.result||[],o=n.length>0?n[n.length-1].lastTimestamp:0,c=e.transaction("model").objectStore("model").getAllKeys();c.onsuccess=(()=>{const s=c.result||[];r({instance:e,user_id:t,lastTimestamp:o,localEntitiesIds:s})}),c.onerror=(()=>s("Error getting Model Keys"))}),a.onerror=(()=>s("Error getting Control Records"))})}function updateDBControl({instance:e,counter:t,newTimestamp:r}){return new Promise(s=>{e.transaction(["control"],"readwrite").objectStore("control").put({_id:r,lastTimestamp:r,counter:t}).onsuccess=(()=>{s({instance:e})})})}function getModelData({instance:e}){return new Promise(t=>{const r=e.transaction("model").objectStore("model").getAll();r.onsuccess=(()=>t(r.result))})}function start(e,{name:t,version:r,user_id:s}){const a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;return a?new Promise((e,n)=>{const o=a.open(t,r);o.onsuccess=(()=>e({instance:o.result,user_id:s})),o.onerror=(()=>n(o.error)),o.onupgradeneeded=(e=>{const t=e.target.result;t.model=t.createObjectStore("model",{keyPath:"_id"}),t.control=t.createObjectStore("control",{keyPath:"_id"})})}).then(getDBMetadata).then(getDataFromServer(e)).then(syncDataToDB).then(updateDBControl).then(getModelData).catch(console.log):new Promise((e,t)=>{getDataFromServer({user_id:s}).then(({items:t})=>e(t)).catch(t)})}function getCurrentAttrs(e){return e.reduce((e,t)=>{const{key:r,value:s,timestamp:a}=t;return e[r]||(e[r]={value:s,dbValue:s,status:1,timestamp:a}),{...e,[r]:a>e[r].timestamp?{value:s,dbValue:s,status:1,timestamp:a}:e[r]}},{})}function hydrate(e){return t=>{t.length>0&&(e.db.data=t.reduce((e,t)=>{const{_id:r,domain:s,attrs:a}=t;return e[s]||(e[s]=[]),{...e,[s]:[...e[s],{_id:r,attrs:getCurrentAttrs(a)}]}},{}),e.objects.flags.IS_MOUNTED&&e.render.update())}}function query(e){return t=>e.db.data&&e.db.data[t]||[]}function initSocket({socketUrl:e,user_id:t,onMessage:r}){if(!e)return console.log("SocketUrl not defined"),()=>void 0;if(!("WebSocket"in window))return console.log("WebSocket not supported"),()=>void 0;const s=new window.WebSocket(e),a=e=>s.send(JSON.stringify(e));return s.onopen=(()=>{console.log("WebSocket opened"),t&&a({user_id:t,isInitial:!0})}),s.onclose=(e=>console.log("WebSocket closed",e)),s.onmessage=(e=>{r(JSON.parse(e.data))}),a}function onMessage(e){return t=>{const{data:r,isInitial:s}=t;if(s&&console.log("Socket first message --\x3e ",t),r){const{_id:t,domain:s,attrs:a}=r;e.db.data[s]||(e.db.data[s]=[]);const n=e.db.data[s].find(e=>e._id===t);n?a.forEach(e=>{const{key:t,value:r,timestamp:s}=e;n.attrs[t]={value:r,dbValue:r,status:3,timestamp:s}}):e.db.data[s].push({_id:t,attrs:a.reduce((e,t)=>{const{key:r,value:s,timestamp:a}=t;return{...e,[r]:{value:s,dbValue:s,status:3,timestamp:a}}},{})}),e.methods.render()}}}function connectStoreToServer(e,{user_id:t}){const r=initSocket({socketUrl:e.router.socketUrl,user_id:t,onMessage:onMessage(e)});return e.sockets={sendJSON:r},e.db={data:null,query:query(e)},start(e,{name:"asyncDB",version:1,user_id:t}).then(hydrate(e)).catch(console.log)}function startApp(e){return({appData:t,client:r})=>{const{currentPage:s,query:a,baseUrl:n,baseFolder:o,moduleName:c,ports:i,isProduction:l,useServiceWorker:u}=t;if(e.router.appData=t,e.router.siteUrl=l?`https://${n}/${o}`:`https://${n}:${i[c].http}`,e.router.socketUrl=i[c].socket?l?`wss://${n}/${o}`:`ws://${n}:${i[c].socket}`:null,u&&"serviceWorker"in window.navigator){const e=l?"prod":"dev";window.navigator.serviceWorker.register(`js/${e}/sw.js`,{scope:"/"}).then(e=>{console.log("Service Worker registration OK!",e)}).catch(e=>{console.log("Service Worker registration FAILED",e)})}s&&e.methods.set({currentPage:s}),a.user&&e.methods.set({user_id:a.user}),connectStoreToServer(e,{user_id:a.user}).then(()=>{e.render.client=r,e.render.mount(),e.methods.emit("MOUNTED")})}}function registerComponent(e){return t=>{e.render.components[t.id]=t}}function uid(e=6){const t=String(Date.now()),r=Math.ceil(t.length/2),s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a=s.length;let n="";for(let t=1;t<=e;t++){n+=s.charAt(Math.floor(Math.random()*a))}return`${t.substr(0,r)}-${n}-${t.substr(r)}`}function get$1(e,t,r){if(!e)return r;if("object"==typeof e&&0===Object.keys(e).length)return r;if("number"==typeof t)return void 0===e[t]?r:e[t];const s=t.split(".");let a=!1;return s.reduce((e,t)=>a?r:e[t]?e[t]:(a=!0,r),e)}function localize(e="en"){return t=>{if("string"==typeof t)return t;if(t[e])return t[e];if(t.en)return t.en;const r=Object.keys(t)[0];return r?t[r]:"Error: localize text not found"}}var utils=Object.freeze({uid:uid,get:get$1,localize:localize});function createStore(e){const t={},{observables:r={},computed:s={},actions:a={},alerts:n={},checks:o={},rootNodeId:c,rootComponent:i}=e;return t.utils=utils,t.router={appData:null,siteUrl:null,socketUrl:null,route:route(t)},t.objects={flags:{IS_MOUNTED:!1},observables:r,computed:s,listeners:[],reactions:[],alerts:[]},t.methods={check:check(t,o),get:get(t),subscribe:subscribe(t),set:set(t),setItem:setItem(t),toggle:toggle(t),notify:notify(t),emit:emit(t),on:on(t),once:once(t),compute:compute(t),computeAll:computeAll(t),alertOn:alertOn(t,n),alertOff:alertOff(t),callServer:callServer(t)},t.render={client:null,components:{},rootComponent:i,rootNodeId:c,registerComponent:registerComponent(t),mount:mount(t),update:update(t),startApp:startApp(t),Events:{}},t.process={queue:[],addToQueue:addToQueue(t),processor:processor(t),runTask:runTask(t),call:callProcesses(t,a)},Object.keys(t.objects.observables).forEach(e=>{t.objects.listeners.push({observable:e,components:[]})}),t.methods.computeAll(),t}function registerStyles(e,t,r){if(t)if(r){document.getElementById("component-styles").innerText+=t}else global.__componentStyles||(global.__componentStyles=""),global.__componentStyles+=t}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var stylis=createCommonjsModule(function(e,t){e.exports=function e(t){var r=/^\0+/g,s=/[\0\r\f]/g,a=/: */g,n=/zoo|gra/,o=/([,: ])(transform)/g,c=/,+\s*(?![^(]*[)])/g,i=/ +\s*(?![^(]*[)])/g,l=/ *[\0] */g,u=/,\r+?/g,d=/([\t\r\n ])*\f?&/g,p=/:global\(((?:[^\(\)\[\]]*|\[.*\]|\([^\(\)]*\))*)\)/g,f=/\W+/g,m=/@(k\w+)\s*(\S*)\s*/,h=/::(place)/g,b=/:(read-only)/g,g=/\s+(?=[{\];=:>])/g,v=/([[}=:>])\s+/g,y=/(\{[^{]+?);(?=\})/g,k=/\s{2,}/g,A=/([^\(])(:+) */g,S=/[svh]\w+-[tblr]{2}/,w=/\(\s*(.*)\s*\)/g,C=/([\s\S]*?);/g,N=/-self|flex-/g,E=/[^]*?(:[rp][el]a[\w-]+)[^]*/,T=/stretch|:\s*\w+\-(?:conte|avail)/,O=/([^-])(image-set\()/,_="-webkit-",$="-moz-",D="-ms-",x=59,j=125,M=123,P=40,I=41,U=91,B=93,H=10,L=13,V=9,z=64,R=32,W=38,q=45,F=95,X=42,K=44,J=58,G=39,Q=34,Y=47,Z=62,ee=43,te=126,re=0,se=12,ae=11,ne=107,oe=109,ce=115,ie=112,le=111,ue=105,de=99,pe=100,fe=112,me=1,he=1,be=0,ge=1,ve=1,ye=1,ke=0,Ae=0,Se=0,we=[],Ce=[],Ne=0,Ee=null,Te=-2,Oe=-1,_e=0,$e=1,De=2,xe=3,je=0,Me=1,Pe="",Ie="",Ue="";function Be(e,t,a,n,o){for(var c,i,u=0,d=0,p=0,f=0,g=0,v=0,y=0,k=0,S=0,C=0,N=0,E=0,T=0,O=0,F=0,ke=0,Ce=0,Ee=0,Te=0,Oe=a.length,Le=Oe-1,Fe="",Xe="",Ke="",Je="",Ge="",Qe="";F<Oe;){if(y=a.charCodeAt(F),F===Le&&d+f+p+u!==0&&(0!==d&&(y=d===Y?H:Y),f=p=u=0,Oe++,Le++),d+f+p+u===0){if(F===Le&&(ke>0&&(Xe=Xe.replace(s,"")),Xe.trim().length>0)){switch(y){case R:case V:case x:case L:case H:break;default:Xe+=a.charAt(F)}y=x}if(1===Ce)switch(y){case M:case j:case x:case Q:case G:case P:case I:case K:Ce=0;case V:case L:case H:case R:break;default:for(Ce=0,Te=F,g=y,F--,y=x;Te<Oe;)switch(a.charCodeAt(Te++)){case H:case L:case x:++F,y=g,Te=Oe;break;case J:ke>0&&(++F,y=g);case M:Te=Oe}}switch(y){case M:for(Xe=Xe.trim(),g=Xe.charCodeAt(0),N=1,Te=++F;F<Oe;){switch(y=a.charCodeAt(F)){case M:N++;break;case j:N--;break;case Y:switch(v=a.charCodeAt(F+1)){case X:case Y:F=qe(v,F,Le,a)}break;case U:y++;case P:y++;case Q:case G:for(;F++<Le&&a.charCodeAt(F)!==y;);}if(0===N)break;F++}switch(Ke=a.substring(Te,F),g===re&&(g=(Xe=Xe.replace(r,"").trim()).charCodeAt(0)),g){case z:switch(ke>0&&(Xe=Xe.replace(s,"")),v=Xe.charCodeAt(1)){case pe:case oe:case ce:case q:c=t;break;default:c=we}if(Ke=Be(t,c,Ke,v,o+1),Te=Ke.length,Se>0&&0===Te&&(Te=Xe.length),Ne>0&&(c=He(we,Xe,Ee),i=We(xe,Ke,c,t,he,me,Te,v,o,n),Xe=c.join(""),void 0!==i&&0===(Te=(Ke=i.trim()).length)&&(v=0,Ke="")),Te>0)switch(v){case ce:Xe=Xe.replace(w,Re);case pe:case oe:case q:Ke=Xe+"{"+Ke+"}";break;case ne:Xe=Xe.replace(m,"$1 $2"+(Me>0?Pe:"")),Ke=Xe+"{"+Ke+"}",Ke=1===ve||2===ve&&ze("@"+Ke,3)?"@"+_+Ke+"@"+Ke:"@"+Ke;break;default:Ke=Xe+Ke,n===fe&&(Je+=Ke,Ke="")}else Ke="";break;default:Ke=Be(t,He(t,Xe,Ee),Ke,n,o+1)}Ge+=Ke,E=0,Ce=0,O=0,ke=0,Ee=0,T=0,Xe="",Ke="",y=a.charCodeAt(++F);break;case j:case x:if(Xe=(ke>0?Xe.replace(s,""):Xe).trim(),(Te=Xe.length)>1)switch(0===O&&((g=Xe.charCodeAt(0))===q||g>96&&g<123)&&(Te=(Xe=Xe.replace(" ",":")).length),Ne>0&&void 0!==(i=We($e,Xe,t,e,he,me,Je.length,n,o,n))&&0===(Te=(Xe=i.trim()).length)&&(Xe="\0\0"),g=Xe.charCodeAt(0),v=Xe.charCodeAt(1),g){case re:break;case z:if(v===ue||v===de){Qe+=Xe+a.charAt(F);break}default:if(Xe.charCodeAt(Te-1)===J)break;Je+=Ve(Xe,g,v,Xe.charCodeAt(2))}E=0,Ce=0,O=0,ke=0,Ee=0,Xe="",y=a.charCodeAt(++F)}}switch(y){case L:case H:if(d+f+p+u+Ae===0)switch(C){case I:case G:case Q:case z:case te:case Z:case X:case ee:case Y:case q:case J:case K:case x:case M:case j:break;default:O>0&&(Ce=1)}d===Y?d=0:ge+E===0&&n!==ne&&Xe.length>0&&(ke=1,Xe+="\0"),Ne*je>0&&We(_e,Xe,t,e,he,me,Je.length,n,o,n),me=1,he++;break;case x:case j:if(d+f+p+u===0){me++;break}default:switch(me++,Fe=a.charAt(F),y){case V:case R:if(f+u+d===0)switch(k){case K:case J:case V:case R:Fe="";break;default:y!==R&&(Fe=" ")}break;case re:Fe="\\0";break;case se:Fe="\\f";break;case ae:Fe="\\v";break;case W:f+d+u===0&&ge>0&&(Ee=1,ke=1,Fe="\f"+Fe);break;case 108:if(f+d+u+be===0&&O>0)switch(F-O){case 2:k===ie&&a.charCodeAt(F-3)===J&&(be=k);case 8:S===le&&(be=S)}break;case J:f+d+u===0&&(O=F);break;case K:d+p+f+u===0&&(ke=1,Fe+="\r");break;case Q:case G:0===d&&(f=f===y?0:0===f?y:f);break;case U:f+d+p===0&&u++;break;case B:f+d+p===0&&u--;break;case I:f+d+u===0&&p--;break;case P:if(f+d+u===0){if(0===E)switch(2*k+3*S){case 533:break;default:N=0,E=1}p++}break;case z:d+p+f+u+O+T===0&&(T=1);break;case X:case Y:if(f+u+p>0)break;switch(d){case 0:switch(2*y+3*a.charCodeAt(F+1)){case 235:d=Y;break;case 220:Te=F,d=X}break;case X:y===Y&&k===X&&Te+2!==F&&(33===a.charCodeAt(Te+2)&&(Je+=a.substring(Te,F+1)),Fe="",d=0)}}if(0===d){if(ge+f+u+T===0&&n!==ne&&y!==x)switch(y){case K:case te:case Z:case ee:case I:case P:if(0===E){switch(k){case V:case R:case H:case L:Fe+="\0";break;default:Fe="\0"+Fe+(y===K?"":"\0")}ke=1}else switch(y){case P:O+7===F&&108===k&&(O=0),E=++N;break;case I:0==(E=--N)&&(ke=1,Fe+="\0")}break;case V:case R:switch(k){case re:case M:case j:case x:case K:case se:case V:case R:case H:case L:break;default:0===E&&(ke=1,Fe+="\0")}}Xe+=Fe,y!==R&&y!==V&&(C=y)}}S=k,k=y,F++}if(Te=Je.length,Se>0&&0===Te&&0===Ge.length&&0===t[0].length==0&&(n!==oe||1===t.length&&(ge>0?Ie:Ue)===t[0])&&(Te=t.join(",").length+2),Te>0){if(c=0===ge&&n!==ne?function(e){for(var t,r,a=0,n=e.length,o=Array(n);a<n;++a){for(var c=e[a].split(l),i="",u=0,d=0,p=0,f=0,m=c.length;u<m;++u)if(!(0===(d=(r=c[u]).length)&&m>1)){if(p=i.charCodeAt(i.length-1),f=r.charCodeAt(0),t="",0!==u)switch(p){case X:case te:case Z:case ee:case R:case P:break;default:t=" "}switch(f){case W:r=t+Ie;case te:case Z:case ee:case R:case I:case P:break;case U:r=t+r+Ie;break;case J:switch(2*r.charCodeAt(1)+3*r.charCodeAt(2)){case 530:if(ye>0){r=t+r.substring(8,d-1);break}default:(u<1||c[u-1].length<1)&&(r=t+Ie+r)}break;case K:t="";default:r=d>1&&r.indexOf(":")>0?t+r.replace(A,"$1"+Ie+"$2"):t+r+Ie}i+=r}o[a]=i.replace(s,"").trim()}return o}(t):t,Ne>0&&void 0!==(i=We(De,Je,c,e,he,me,Te,n,o,n))&&0===(Je=i).length)return Qe+Je+Ge;if(Je=c.join(",")+"{"+Je+"}",ve*be!=0){switch(2!==ve||ze(Je,2)||(be=0),be){case le:Je=Je.replace(b,":"+$+"$1")+Je;break;case ie:Je=Je.replace(h,"::"+_+"input-$1")+Je.replace(h,"::"+$+"$1")+Je.replace(h,":"+D+"input-$1")+Je}be=0}}return Qe+Je+Ge}function He(e,t,r){var s=t.trim().split(u),a=s,n=s.length,o=e.length;switch(o){case 0:case 1:for(var c=0,i=0===o?"":e[0]+" ";c<n;++c)a[c]=Le(i,a[c],r,o).trim();break;default:for(var c=0,l=0,a=[];c<n;++c)for(var d=0;d<o;++d)a[l++]=Le(e[d]+" ",s[c],r,o).trim()}return a}function Le(e,t,r,s){var a=t,n=a.charCodeAt(0);switch(n<33&&(n=(a=a.trim()).charCodeAt(0)),n){case W:switch(ge+s){case 0:case 1:if(0===e.trim().length)break;default:return a.replace(d,"$1"+e.trim())}break;case J:switch(a.charCodeAt(1)){case 103:if(ye>0&&ge>0)return a.replace(p,"$1").replace(d,"$1"+Ue);break;default:return e.trim()+a.replace(d,"$1"+e.trim())}default:if(r*ge>0&&a.indexOf("\f")>0)return a.replace(d,(e.charCodeAt(0)===J?"":"$1")+e.trim())}return e+a}function Ve(e,t,r,s){var l,u=0,d=e+";",p=2*t+3*r+4*s;if(944===p)return function(e){var t=e.length,r=e.indexOf(":",9)+1,s=e.substring(0,r).trim(),a=e.substring(r,t-1).trim();switch(e.charCodeAt(9)*Me){case 0:break;case q:if(110!==e.charCodeAt(10))break;default:for(var n=a.split((a="",c)),o=0,r=0,t=n.length;o<t;r=0,++o){for(var l=n[o],u=l.split(i);l=u[r];){var d=l.charCodeAt(0);if(1===Me&&(d>z&&d<90||d>96&&d<123||d===F||d===q&&l.charCodeAt(1)!==q))switch(isNaN(parseFloat(l))+(-1!==l.indexOf("("))){case 1:switch(l){case"infinite":case"alternate":case"backwards":case"running":case"normal":case"forwards":case"both":case"none":case"linear":case"ease":case"ease-in":case"ease-out":case"ease-in-out":case"paused":case"reverse":case"alternate-reverse":case"inherit":case"initial":case"unset":case"step-start":case"step-end":break;default:l+=Pe}}u[r++]=l}a+=(0===o?"":",")+u.join(" ")}}return a=s+a+";",1===ve||2===ve&&ze(a,1)?_+a+a:a}(d);if(0===ve||2===ve&&!ze(d,1))return d;switch(p){case 1015:return 97===d.charCodeAt(10)?_+d+d:d;case 951:return 116===d.charCodeAt(3)?_+d+d:d;case 963:return 110===d.charCodeAt(5)?_+d+d:d;case 1009:if(100!==d.charCodeAt(4))break;case 969:case 942:return _+d+d;case 978:return _+d+$+d+d;case 1019:case 983:return _+d+$+d+D+d+d;case 883:return d.charCodeAt(8)===q?_+d+d:d.indexOf("image-set(",11)>0?d.replace(O,"$1"+_+"$2")+d:d;case 932:if(d.charCodeAt(4)===q)switch(d.charCodeAt(5)){case 103:return _+"box-"+d.replace("-grow","")+_+d+D+d.replace("grow","positive")+d;case 115:return _+d+D+d.replace("shrink","negative")+d;case 98:return _+d+D+d.replace("basis","preferred-size")+d}return _+d+D+d+d;case 964:return _+d+D+"flex-"+d+d;case 1023:if(99!==d.charCodeAt(8))break;return l=d.substring(d.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),_+"box-pack"+l+_+d+D+"flex-pack"+l+d;case 1005:return n.test(d)?d.replace(a,":"+_)+d.replace(a,":"+$)+d:d;case 1e3:switch(l=d.substring(13).trim(),u=l.indexOf("-")+1,l.charCodeAt(0)+l.charCodeAt(u)){case 226:l=d.replace(S,"tb");break;case 232:l=d.replace(S,"tb-rl");break;case 220:l=d.replace(S,"lr");break;default:return d}return _+d+D+l+d;case 1017:if(-1===d.indexOf("sticky",9))return d;case 975:switch(u=(d=e).length-10,l=(33===d.charCodeAt(u)?d.substring(0,u):d).substring(e.indexOf(":",7)+1).trim(),p=l.charCodeAt(0)+(0|l.charCodeAt(7))){case 203:if(l.charCodeAt(8)<111)break;case 115:d=d.replace(l,_+l)+";"+d;break;case 207:case 102:d=d.replace(l,_+(p>102?"inline-":"")+"box")+";"+d.replace(l,_+l)+";"+d.replace(l,D+l+"box")+";"+d}return d+";";case 938:if(d.charCodeAt(5)===q)switch(d.charCodeAt(6)){case 105:return l=d.replace("-items",""),_+d+_+"box-"+l+D+"flex-"+l+d;case 115:return _+d+D+"flex-item-"+d.replace(N,"")+d;default:return _+d+D+"flex-line-pack"+d.replace("align-content","").replace(N,"")+d}break;case 973:case 989:if(d.charCodeAt(3)!==q||122===d.charCodeAt(4))break;case 931:case 953:if(!0===T.test(e))return 115===(l=e.substring(e.indexOf(":")+1)).charCodeAt(0)?Ve(e.replace("stretch","fill-available"),t,r,s).replace(":fill-available",":stretch"):d.replace(l,_+l)+d.replace(l,$+l.replace("fill-",""))+d;break;case 962:if(d=_+d+(102===d.charCodeAt(5)?D+d:"")+d,r+s===211&&105===d.charCodeAt(13)&&d.indexOf("transform",10)>0)return d.substring(0,d.indexOf(";",27)+1).replace(o,"$1"+_+"$2")+d}return d}function ze(e,t){var r=e.indexOf(1===t?":":"{"),s=e.substring(0,3!==t?r:10),a=e.substring(r+1,e.length-1);return Ee(2!==t?s:s.replace(E,"$1"),a,t)}function Re(e,t){var r=Ve(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return r!==t+";"?r.replace(C," or ($1)").substring(4):"("+t+")"}function We(e,t,r,s,a,n,o,c,i,l){for(var u,d=0,p=t;d<Ne;++d)switch(u=Ce[d].call(Xe,e,p,r,s,a,n,o,c,i,l)){case void 0:case!1:case!0:case null:break;default:p=u}if(p!==t)return p}function qe(e,t,r,s){for(var a=t+1;a<r;++a)switch(s.charCodeAt(a)){case Y:if(e===X&&s.charCodeAt(a-1)===X&&t+2!==a)return a+1;break;case H:if(e===Y)return a+1}return a}function Fe(e){for(var t in e){var r=e[t];switch(t){case"keyframe":Me=0|r;break;case"global":ye=0|r;break;case"cascade":ge=0|r;break;case"compress":ke=0|r;break;case"semicolon":Ae=0|r;break;case"preserve":Se=0|r;break;case"prefix":Ee=null,r?"function"!=typeof r?ve=1:(ve=2,Ee=r):ve=0}}return Fe}function Xe(t,r){if(void 0!==this&&this.constructor===Xe)return e(t);var a=t,n=a.charCodeAt(0);n<33&&(n=(a=a.trim()).charCodeAt(0)),Me>0&&(Pe=a.replace(f,n===U?"":"-")),n=1,1===ge?Ue=a:Ie=a;var o,c=[Ue];Ne>0&&void 0!==(o=We(Oe,r,c,c,he,me,0,0,0,0))&&"string"==typeof o&&(r=o);var i=Be(we,c,r,0,0);return Ne>0&&void 0!==(o=We(Te,i,c,c,he,me,i.length,0,0,0))&&"string"!=typeof(i=o)&&(n=0),Pe="",Ue="",Ie="",be=0,he=1,me=1,ke*n==0?i:function(e){return e.replace(s,"").replace(g,"").replace(v,"$1").replace(y,"$1").replace(k," ")}(i)}return Xe.use=function e(t){switch(t){case void 0:case null:Ne=Ce.length=0;break;default:if("function"==typeof t)Ce[Ne++]=t;else if("object"==typeof t)for(var r=0,s=t.length;r<s;++r)e(t[r]);else je=0|!!t}return e},Xe.set=Fe,void 0!==t&&Fe(t),Xe}(null)});function processStyle(e,t){if(e)return stylis(`.${e}`,t);const r=stylis("",t);return r.substr(1,r.length-2)}function getClasses(e,t={}){const r=Object.keys(t);return{rules:r.reduce((r,s)=>{return`${r}${processStyle(`${s}--${e}`,t[s])}`},""),mapping:r.reduce((t,r)=>{return{...t,[r]:`${r}--${e}`}},{})}}function getStyles(e={}){return Object.keys(e).reduce((t,r)=>{const s=e[r];return{...t,[r]:"function"==typeof s?(...e)=>processStyle(null,s(...e)):processStyle(null,s)}},{})}var styles={registerStyles:registerStyles,getClasses:getClasses,getStyles:getStyles};function getFinalProps(e){const t=e.props||{},{store:r,componentDef:s,processedClasses:a,processedStyles:n,utils:o}=e;return{props:t,state:s.state?s.state(t,r):{},actions:s.actions?s.actions(t,r):{},styles:n,classes:a.mapping,utils:o}}function getStore(e,t){return{alerts:e.objects.alerts,addAlert:e.methods.alertOn,check:e.methods.check,toggle:e.methods.toggle,set:e.methods.set,setItem:e.methods.setItem,call:e.process.call,callServer:e.methods.callServer,get:e.methods.get(t),route:e.router.route,utils:{get:e.utils.get,uid:e.utils.uid,localize:e.utils.localize(e.objects.observables.language)},db:e.db?e.db.query:()=>void 0}}var createHoc=(e,t)=>{if(t){document.getElementById("component-styles").innerText=""}return r=>{r.id||(r.id=1e3),e.render.registerComponent(r);const s=styles.getClasses(r.id,r.classes);styles.registerStyles(r.id,s.rules,t);const a=getStore(e),n=a.utils,o=styles.getStyles(r.styles);return function(t,c){!e.objects.flags.IS_MOUNTED&&r.mounted&&e.methods.on("MOUNTED",()=>{r.mounted(t,a)});const i=getFinalProps({props:t,utils:n,store:a,componentDef:r,processedClasses:s,processedStyles:o});return r.render(i,c)}}};const isSvgElement=e=>["circle","defs","ellipse","g","line","path","polygon","polyline","rect","svg","text","use"].includes(e),isSpecialProp=e=>["__innerHTML"].includes(e),appendText=(e,t)=>{const r=document.createTextNode(t);e.appendChild(r)},addSpecialProp=(e,t,r)=>{"__innerHTML"===t&&(e.innerHTML=r)},appendArray=(e,t)=>{t.forEach(t=>{Array.isArray(t)?appendArray(e,t):t instanceof window.Element?e.appendChild(t):"string"==typeof t&&appendText(e,t)})};var utils$1={isSvgElement:isSvgElement,isSpecialProp:isSpecialProp,addSpecialProp:addSpecialProp,appendText:appendText,appendArray:appendArray};const NS="http://www.w3.org/2000/svg";var createHDom=(e,t)=>(r,s={},...a)=>{if("function"==typeof r)return s?r({...s},a):r();const n=utils$1.isSvgElement(r)?document.createElementNS(NS,r):document.createElement(r);return a instanceof window.Element?n.appendChild(a):"string"==typeof a?utils$1.appendText(n,a):Array.isArray(a)&&utils$1.appendArray(n,a),s&&Object.keys(s).forEach(a=>{const o=s[a];a.startsWith("on")&&(e.render.Events[a]=!0),"style"!==a||t?"class"===a?n.className=o:a in n?o&&(n[a]=o):utils$1.isSpecialProp(a)?utils$1.addSpecialProp(n,a,o):console.warn(`${a} is not a valid property of a <${r}>`):n.setAttribute("data-style",o)}),n};function createScript(e,t){if(document.getElementById(e))return;const r=document.createElement("script");r.id=e,r.src=t,r.async=1,r.defer=1,document.body.appendChild(r)}var utils$2={prepareComponents(e,t,r,s){let a=s;Object.keys(r).forEach(s=>{const n=r[s];e.ui[t][s]=n(e,a),a++})}};function createClient(e,t){const{Store:r,lib:s,components:a,fragments:n,pages:o}=e,c={h:createHDom(r,t),ui:{components:{},fragments:{},pages:{}},createScript:createScript};return c.hoc=createHoc(r,t),c.lib=s,utils$2.prepareComponents(c,"components",a,4e3),utils$2.prepareComponents(c,"fragments",n,3e3),utils$2.prepareComponents(c,"pages",o,2e3),c}var init=(e,t=!1)=>{const{store:r,lib:s,rootComponent:a,rootNodeId:n,components:o={},fragments:c={},pages:i={}}=e,l=createStore({...r,rootNodeId:n,rootComponent:a});t&&(window.Store=l);const u=createClient({Store:l,lib:s,components:o,fragments:c,pages:i},t);return t&&(window.onload=(()=>{l.render.startApp({appData:window[globals.WINDOW_APP_DATA],client:u})})),u};const client={init:init};export{client};