function get(e){return t=>r=>(e.methods.subscribe(t,r),e.objects.observables[r])}function subscribe(e){return(t,r)=>{const a=e.objects.listeners.find(e=>e.observable===r);if(!a)return console.log(`Listener not found on observable ${r}`);const s=a.components;s.find(e=>e.registerNumber===t)||s.push({registerNumber:t})}}const isPlainValue=e=>["string","number","boolean"].includes(typeof e),wasChanged=(e,t)=>e!==t,shouldNotify=(e,t)=>!isPlainValue(t)||isPlainValue(t)&&wasChanged(e,t);function set(e){return(t,r={})=>{if(!t)return;const{dynamic:a=!1,timeout:s=0}=r;Object.keys(t).forEach(r=>{const n=e.objects.observables[r],o=Array.isArray(n)?[...n]:"object"==typeof n?{...n}:n,c="function"==typeof t[r]?t[r](o):t[r];typeof n==typeof c||a?shouldNotify(n,c)&&setTimeout(()=>{e.objects.observables[r]=c,e.methods.notify(r)},s):console.warn(`Type does not match previous type in ${r}`)})}}function setItem(e){return(t,r)=>{const a=e.objects.observables[t].findIndex(e=>e.id===r.id);e.objects.observables[t][a]=r,e.methods.notify(t)}}function toggle(e){return(t,r)=>{const a=e.objects.observables[t];void 0===a?console.warn(`Observable [${t}] does not exists.`):"boolean"!=typeof a?console.warn(`Observable [${t}] is not a boolean.`):(e.methods.set({[t]:!a}),r&&r(!a))}}function notify(e){return t=>{t&&Object.keys(e.objects.computed).forEach(r=>{const{take:a}=e.objects.computed[r];a.includes(t)&&e.methods.compute(r)}),e.objects.flags.IS_MOUNTED&&e.render.update()}}function compute(e){return t=>{const{take:r,calc:a}=e.objects.computed[t],s=r.map(t=>e.objects.observables[t]);e.objects.observables[t]=a(...s)}}function computeAll(e){return()=>{Object.keys(e.objects.computed).forEach(t=>{e.methods.compute(t)})}}function emit(e){return(t,r)=>{"MOUNTED"===t&&(e.objects.flags.IS_MOUNTED=!0),e.objects.reactions.filter(e=>e.keepAlive?e.eventStr===t:e.eventStr===t&&!e.done).forEach(e=>{e.done=!0,e.callback(r)})}}function on(e){return(t,r)=>{e.objects.reactions.push({eventStr:t,callback:r,keepAlive:!0})}}function once(e){return(t,r)=>{e.objects.reactions.push({eventStr:t,callback:r,done:!1})}}function check(e,t){return(e,r)=>{const{result:a,message:s}=t[e](r);return{result:a,message:s}}}function alertOn(e,t){return(r={})=>{const a=Math.floor(1e3*Math.random()),s=Date.now(),n=`${s}--${a}`,o=r.name?t[r.name]:r.message||"Alert message not defined";e.objects.alerts.push({_id:n,...r,message:o,timestamp:s,isVisible:!0}),e.methods.notify(null),r.timeout&&setTimeout(()=>{e.methods.alertOff({_id:n})},r.timeout)}}function alertOff(e){return({_id:t})=>{const r=e.objects.alerts.find(e=>e._id===t);r&&(r.isVisible=!1,e.methods.notify(null))}}function callServer(e){return(t,r={})=>new Promise((a,s)=>{const n=new window.XMLHttpRequest;n.open("POST",`${e.router.siteUrl}/api/methods`,!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=(()=>{if(n.readyState===window.XMLHttpRequest.DONE){const e=n.status;if(![200,201].includes(e))return s("XHR request failed");const t=n.responseText;return a(JSON.parse(t))}});const o=JSON.stringify({method:t,args:r});n.send(o)})}function route(e){return(t,r)=>{const{moduleName:a,routes:s,ports:n,isProduction:o,baseUrl:c}=e.router.appData,i=r?`${t}${r}`:t,l=Object.keys(s).reduce((e,r)=>s[r].includes(t)?r:e,!1);if(l&&l===a)window.history.replaceState(null,null,i);else{const e=o?`/${i}`:`https://${c}:${n[l].http}/${i}`;window.location.replace(e)}}}const noop=()=>void 0;function addToQueue(e){return({name:t,steps:r,onError:a})=>{const s=Date.now(),n={_id:s,name:t,steps:r,done:!1,onError:a||noop};e.process.queue.splice(0,0,n),e.process.runTask({_id:s})}}function callProcesses(e,t){if(!t)return()=>void 0;const r={get:t=>e.objects.observables[t],set:e.methods.set,addAlert:e.methods.alertOn,callServer:e.methods.callServer,route:e.router.route,uid:e.utils.uid},a=Object.keys(t).reduce((a,s)=>{const n=t[s];return{...a,[s]:t=>{e.process.addToQueue({name:s,...n(r)(t)})}}},{});return(e,t)=>a[e](t)}function processor(){return({steps:e,onError:t})=>{let r=!0;e.reduce((e,a)=>e.then(e=>{if(r)return a(e)}).catch(e=>{r=!1,console.log("processPromiseChain ERROR -----------------\x3e ",e),t(e)}),Promise.resolve({}))}}function runTask(e){return({_id:t})=>{const r=e.process.queue.find(e=>e._id===t);e.process.processor(r),r.done=!0}}function mount(e){return()=>{const{rootComponent:t,client:r}=e.render,a=t(r)();document.body.innerHTML="",document.body.appendChild(a)}}var range,actualHasAttributeNS,NS_XHTML="http://www.w3.org/1999/xhtml",doc="undefined"==typeof document?void 0:document,testEl=doc?doc.body||doc.createElement("div"):{},hasAttributeNS=actualHasAttributeNS=testEl.hasAttributeNS?function(e,t,r){return e.hasAttributeNS(t,r)}:testEl.hasAttribute?function(e,t,r){return e.hasAttribute(r)}:function(e,t,r){return null!=e.getAttributeNode(t,r)};function toElement(e){var t;return!range&&doc.createRange&&(range=doc.createRange()).selectNode(doc.body),range&&range.createContextualFragment?t=range.createContextualFragment(e):(t=doc.createElement("body")).innerHTML=e,t.childNodes[0]}function compareNodeNames(e,t){var r=e.nodeName,a=t.nodeName;return r===a||!!(t.actualize&&r.charCodeAt(0)<91&&a.charCodeAt(0)>90)&&r===a.toUpperCase()}function createElementNS(e,t){return t&&t!==NS_XHTML?doc.createElementNS(t,e):doc.createElement(e)}function moveChildren(e,t){for(var r=e.firstChild;r;){var a=r.nextSibling;t.appendChild(r),r=a}return t}function morphAttrs(e,t){var r,a,s,n,o,c=t.attributes;for(r=c.length-1;r>=0;--r)s=(a=c[r]).name,n=a.namespaceURI,o=a.value,n?(s=a.localName||s,e.getAttributeNS(n,s)!==o&&e.setAttributeNS(n,s,o)):e.getAttribute(s)!==o&&e.setAttribute(s,o);for(r=(c=e.attributes).length-1;r>=0;--r)!1!==(a=c[r]).specified&&(s=a.name,(n=a.namespaceURI)?(s=a.localName||s,hasAttributeNS(t,n,s)||e.removeAttributeNS(n,s)):hasAttributeNS(t,null,s)||e.removeAttribute(s))}function syncBooleanAttrProp(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r,""))}var specialElHandlers={OPTION:function(e,t){syncBooleanAttrProp(e,t,"selected")},INPUT:function(e,t){syncBooleanAttrProp(e,t,"checked"),syncBooleanAttrProp(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),hasAttributeNS(t,null,"value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var a=e.firstChild;if(a){var s=a.nodeValue;if(s==r||!r&&s==e.placeholder)return;a.nodeValue=r}},SELECT:function(e,t){if(!hasAttributeNS(t,null,"multiple")){for(var r=0,a=t.firstChild;a;){var s=a.nodeName;if(s&&"OPTION"===s.toUpperCase()){if(hasAttributeNS(a,null,"selected"))break;r++}a=a.nextSibling}e.selectedIndex=r}}},ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8;function noop$1(){}function defaultGetNodeKey(e){return e.id}function morphdomFactory(e){return function(t,r,a){if(a||(a={}),"string"==typeof r)if("#document"===t.nodeName||"HTML"===t.nodeName){var s=r;(r=doc.createElement("html")).innerHTML=s}else r=toElement(r);var n,o=a.getNodeKey||defaultGetNodeKey,c=a.onBeforeNodeAdded||noop$1,i=a.onNodeAdded||noop$1,l=a.onBeforeElUpdated||noop$1,u=a.onElUpdated||noop$1,d=a.onBeforeNodeDiscarded||noop$1,p=a.onNodeDiscarded||noop$1,f=a.onBeforeElChildrenUpdated||noop$1,m=!0===a.childrenOnly,h={};function b(e){n?n.push(e):n=[e]}function g(e,t,r){!1!==d(e)&&(t&&t.removeChild(e),p(e),function e(t,r){if(t.nodeType===ELEMENT_NODE)for(var a=t.firstChild;a;){var s=void 0;r&&(s=o(a))?b(s):(p(a),a.firstChild&&e(a,r)),a=a.nextSibling}}(e,r))}function v(e){i(e);for(var t=e.firstChild;t;){var r=t.nextSibling,a=o(t);if(a){var s=h[a];s&&compareNodeNames(t,s)&&(t.parentNode.replaceChild(s,t),k(s,t))}v(t),t=r}}function k(a,s,n){var i,d=o(s);if(d&&delete h[d],!r.isSameNode||!r.isSameNode(t)){if(!n){if(!1===l(a,s))return;if(e(a,s),u(a),!1===f(a,s))return}if("TEXTAREA"!==a.nodeName){var p,m,A,y,w=s.firstChild,S=a.firstChild;e:for(;w;){for(A=w.nextSibling,p=o(w);S;){if(m=S.nextSibling,w.isSameNode&&w.isSameNode(S)){w=A,S=m;continue e}i=o(S);var C=S.nodeType,N=void 0;if(C===w.nodeType&&(C===ELEMENT_NODE?(p?p!==i&&((y=h[p])?S.nextSibling===y?N=!1:(a.insertBefore(y,S),m=S.nextSibling,i?b(i):g(S,a,!0),S=y):N=!1):i&&(N=!1),(N=!1!==N&&compareNodeNames(S,w))&&k(S,w)):C!==TEXT_NODE&&C!=COMMENT_NODE||(N=!0,S.nodeValue!==w.nodeValue&&(S.nodeValue=w.nodeValue))),N){w=A,S=m;continue e}i?b(i):g(S,a,!0),S=m}if(p&&(y=h[p])&&compareNodeNames(y,w))a.appendChild(y),k(y,w);else{var E=c(w);!1!==E&&(E&&(w=E),w.actualize&&(w=w.actualize(a.ownerDocument||doc)),a.appendChild(w),v(w))}w=A,S=m}for(;S;)m=S.nextSibling,(i=o(S))?b(i):g(S,a,!0),S=m}var T=specialElHandlers[a.nodeName];T&&T(a,s)}}!function e(t){if(t.nodeType===ELEMENT_NODE)for(var r=t.firstChild;r;){var a=o(r);a&&(h[a]=r),e(r),r=r.nextSibling}}(t);var A=t,y=A.nodeType,w=r.nodeType;if(!m)if(y===ELEMENT_NODE)w===ELEMENT_NODE?compareNodeNames(t,r)||(p(t),A=moveChildren(t,createElementNS(r.nodeName,r.namespaceURI))):A=r;else if(y===TEXT_NODE||y===COMMENT_NODE){if(w===y)return A.nodeValue!==r.nodeValue&&(A.nodeValue=r.nodeValue),A;A=r}if(A===r)p(t);else if(k(A,r,m),n)for(var S=0,C=n.length;S<C;S++){var N=h[n[S]];N&&g(N,N.parentNode,!1)}return!m&&A!==t&&t.parentNode&&(A.actualize&&(A=A.actualize(t.ownerDocument||doc)),t.parentNode.replaceChild(A,t)),A}}var morphdom=morphdomFactory(morphAttrs),morphdom_1=morphdom;function update(e){return()=>{const{rootComponent:t,client:r,rootNodeId:a,Events:s}=e.render,n=Object.keys(s),o=t(r)(),c=document.getElementById(a);morphdom_1(c,o,{onBeforeElUpdated(e,t){e.id&&console.log(e.id),n.forEach(r=>{e[r]&&(e[r]=t[r])})},onBeforeNodeDiscarded(e){if(e.tagName&&"iframe"===e.tagName.toLowerCase())return!1}})}}var globals={SYSTEM_DB_USER_ID:"0000000-system-000000",WINDOW_APP_DATA:"__appData__",GET_MODEL_DATA_METHOD:"@server-model.getData"};function getDataFromServer(e){return t=>{const{instance:r=null,user_id:a,lastTimestamp:s=0,localEntitiesIds:n=[]}=t,o={user_id:a,lastTimestamp:s,localEntitiesIds:n};return new Promise((t,a)=>{e.methods.callServer(globals.GET_MODEL_DATA_METHOD,o).then(e=>{e||a("Could not get data from server");const s=Date.now();t({instance:r,items:e,newTimestamp:s})}).catch(a)})}}function syncDataToDB({instance:e,items:t,newTimestamp:r}){let a=0;return new Promise(s=>{0===t.length&&s({instance:e,counter:a,newTimestamp:r});const n=e.transaction(["model"],"readwrite").objectStore("model"),o=n.getAll();o.onsuccess=(()=>{const c=o.result;t.forEach(o=>{if(o.attrs.length>0){const i=c.find(e=>e._id===o._id);n.put({_id:o._id,domain:o.domain,attrs:i?[...i.attrs,...o.attrs]:o.attrs}).onsuccess=(()=>{++a===t.length&&s({instance:e,counter:a,newTimestamp:r})})}})})})}function getDBMetadata({instance:e,user_id:t}){return new Promise((r,a)=>{const s=e.transaction("control").objectStore("control").getAll();s.onsuccess=(()=>{const n=s.result||[],o=n.length>0?n[n.length-1].lastTimestamp:0,c=e.transaction("model").objectStore("model").getAllKeys();c.onsuccess=(()=>{const a=c.result||[];r({instance:e,user_id:t,lastTimestamp:o,localEntitiesIds:a})}),c.onerror=(()=>a("Error getting Model Keys"))}),s.onerror=(()=>a("Error getting Control Records"))})}function updateDBControl({instance:e,counter:t,newTimestamp:r}){return new Promise(a=>{e.transaction(["control"],"readwrite").objectStore("control").put({_id:r,lastTimestamp:r,counter:t}).onsuccess=(()=>{a({instance:e})})})}function getModelData({instance:e}){return new Promise(t=>{const r=e.transaction("model").objectStore("model").getAll();r.onsuccess=(()=>t(r.result))})}function start(e,{name:t,version:r,user_id:a}){const s=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;return s?new Promise((e,n)=>{const o=s.open(t,r);o.onsuccess=(()=>e({instance:o.result,user_id:a})),o.onerror=(()=>n(o.error)),o.onupgradeneeded=(e=>{const t=e.target.result;t.model=t.createObjectStore("model",{keyPath:"_id"}),t.control=t.createObjectStore("control",{keyPath:"_id"})})}).then(getDBMetadata).then(getDataFromServer(e)).then(syncDataToDB).then(updateDBControl).then(getModelData).catch(console.log):new Promise((e,t)=>{getDataFromServer({user_id:a}).then(({items:t})=>e(t)).catch(t)})}function getCurrentAttrs(e){return e.reduce((e,t)=>{const{key:r,value:a,timestamp:s}=t;return e[r]||(e[r]={value:a,dbValue:a,status:1,timestamp:s}),{...e,[r]:s>e[r].timestamp?{value:a,dbValue:a,status:1,timestamp:s}:e[r]}},{})}function hydrate(e){return t=>{t.length>0&&(e.db.data=t.reduce((e,t)=>{const{_id:r,domain:a,attrs:s}=t;return e[a]||(e[a]=[]),{...e,[a]:[...e[a],{_id:r,attrs:getCurrentAttrs(s)}]}},{}),e.objects.flags.IS_MOUNTED&&e.render.update())}}function query(e){return t=>e.db.data&&e.db.data[t]||[]}function initSocket({socketUrl:e,user_id:t,onMessage:r}){if(!e)return console.log("SocketUrl not defined"),()=>void 0;if(!("WebSocket"in window))return console.log("WebSocket not supported"),()=>void 0;const a=new window.WebSocket(e),s=e=>a.send(JSON.stringify(e));return a.onopen=(()=>{console.log("WebSocket opened"),t&&s({user_id:t,isInitial:!0})}),a.onclose=(e=>console.log("WebSocket closed",e)),a.onmessage=(e=>{r(JSON.parse(e.data))}),s}function onMessage(e){return t=>{const{data:r,isInitial:a}=t;if(a&&console.log("Socket first message --\x3e ",t),r){const{_id:t,domain:a,attrs:s}=r;e.db.data[a]||(e.db.data[a]=[]);const n=e.db.data[a].find(e=>e._id===t);n?s.forEach(e=>{const{key:t,value:r,timestamp:a}=e;n.attrs[t]={value:r,dbValue:r,status:3,timestamp:a}}):e.db.data[a].push({_id:t,attrs:s.reduce((e,t)=>{const{key:r,value:a,timestamp:s}=t;return{...e,[r]:{value:a,dbValue:a,status:3,timestamp:s}}},{})}),e.methods.render()}}}function connectStoreToServer(e,{user_id:t}){const r=initSocket({socketUrl:e.router.socketUrl,user_id:t,onMessage:onMessage(e)});return e.sockets={sendJSON:r},e.db={data:null,query:query(e)},start(e,{name:"asyncDB",version:1,user_id:t}).then(hydrate(e)).catch(console.log)}function startApp(e){return({appData:t,client:r})=>{const{currentPage:a,query:s,baseUrl:n,moduleName:o,ports:c,isProduction:i,useServiceWorker:l}=t;if(e.router.appData=t,e.router.siteUrl=i?`https://${n}`:`https://${n}:${c[o].http}`,e.router.socketUrl=c[o].socket?i?`wss://${n}`:`ws://${n}:${c[o].socket}`:null,l&&"serviceWorker"in window.navigator){const e=i?"prod":"dev";window.navigator.serviceWorker.register(`js/${e}/sw.js`,{scope:"/"}).then(e=>{console.log("Service Worker registration OK!",e)}).catch(e=>{console.log("Service Worker registration FAILED",e)})}a&&e.methods.set({currentPage:a}),s.user&&e.methods.set({user_id:s.user}),connectStoreToServer(e,{user_id:s.user}).then(()=>{e.render.client=r,e.render.mount(),e.methods.emit("MOUNTED")})}}function registerComponent(e){return t=>{e.render.components[t.id]=t}}function uid(e=6){const t=String(Date.now()),r=Math.ceil(t.length/2),a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s=a.length;let n="";for(let t=1;t<=e;t++){n+=a.charAt(Math.floor(Math.random()*s))}return`${t.substr(0,r)}-${n}-${t.substr(r)}`}function get$1(e,t,r){if(!e)return r;if("object"==typeof e&&0===Object.keys(e).length)return r;if("number"==typeof t)return void 0===e[t]?r:e[t];const a=t.split(".");let s=!1;return a.reduce((e,t)=>s?r:e[t]?e[t]:(s=!0,r),e)}function localize(e="en"){return t=>{if("string"==typeof t)return t;if(t[e])return t[e];if(t.en)return t.en;const r=Object.keys(t)[0];return r?t[r]:"Error: localize text not found"}}var utils=Object.freeze({uid:uid,get:get$1,localize:localize});function createStore(e){const t={},{observables:r={},computed:a={},actions:s={},alerts:n={},checks:o={},rootNodeId:c,rootComponent:i}=e;return t.utils=utils,t.router={appData:null,siteUrl:null,socketUrl:null,route:route(t)},t.objects={flags:{IS_MOUNTED:!1},observables:r,computed:a,listeners:[],reactions:[],alerts:[]},t.methods={check:check(t,o),get:get(t),subscribe:subscribe(t),set:set(t),setItem:setItem(t),toggle:toggle(t),notify:notify(t),emit:emit(t),on:on(t),once:once(t),compute:compute(t),computeAll:computeAll(t),alertOn:alertOn(t,n),alertOff:alertOff(t),callServer:callServer(t)},t.render={client:null,components:{},rootComponent:i,rootNodeId:c,registerComponent:registerComponent(t),mount:mount(t),update:update(t),startApp:startApp(t),Events:{}},t.process={queue:[],addToQueue:addToQueue(t),processor:processor(t),runTask:runTask(t),call:callProcesses(t,s)},Object.keys(t.objects.observables).forEach(e=>{t.objects.listeners.push({observable:e,components:[]})}),t.methods.computeAll(),t}function registerStyles(e,t,r,a){if(t)if(r&&!a){document.getElementById("component-styles").innerText+=t}else global.__componentStyles||(global.__componentStyles=""),global.__componentStyles+=t}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var stylis=createCommonjsModule(function(e,t){e.exports=function e(t){var r=/^\0+/g,a=/[\0\r\f]/g,s=/: */g,n=/zoo|gra/,o=/([,: ])(transform)/g,c=/,+\s*(?![^(]*[)])/g,i=/ +\s*(?![^(]*[)])/g,l=/ *[\0] */g,u=/,\r+?/g,d=/([\t\r\n ])*\f?&/g,p=/:global\(((?:[^\(\)\[\]]*|\[.*\]|\([^\(\)]*\))*)\)/g,f=/\W+/g,m=/@(k\w+)\s*(\S*)\s*/,h=/::(place)/g,b=/:(read-only)/g,g=/\s+(?=[{\];=:>])/g,v=/([[}=:>])\s+/g,k=/(\{[^{]+?);(?=\})/g,A=/\s{2,}/g,y=/([^\(])(:+) */g,w=/[svh]\w+-[tblr]{2}/,S=/\(\s*(.*)\s*\)/g,C=/([\s\S]*?);/g,N=/-self|flex-/g,E=/[^]*?(:[rp][el]a[\w-]+)[^]*/,T=/stretch|:\s*\w+\-(?:conte|avail)/,O=/([^-])(image-set\()/,_="-webkit-",D="-moz-",$="-ms-",x=59,j=125,M=123,P=40,I=41,U=91,B=93,H=10,L=13,V=9,R=64,W=32,z=38,q=45,F=95,X=42,K=44,J=58,G=39,Q=34,Y=47,Z=62,ee=43,te=126,re=0,ae=12,se=11,ne=107,oe=109,ce=115,ie=112,le=111,ue=105,de=99,pe=100,fe=112,me=1,he=1,be=0,ge=1,ve=1,ke=1,Ae=0,ye=0,we=0,Se=[],Ce=[],Ne=0,Ee=null,Te=-2,Oe=-1,_e=0,De=1,$e=2,xe=3,je=0,Me=1,Pe="",Ie="",Ue="";function Be(e,t,s,n,o){for(var c,i,u=0,d=0,p=0,f=0,g=0,v=0,k=0,A=0,w=0,C=0,N=0,E=0,T=0,O=0,F=0,Ae=0,Ce=0,Ee=0,Te=0,Oe=s.length,Le=Oe-1,Fe="",Xe="",Ke="",Je="",Ge="",Qe="";F<Oe;){if(k=s.charCodeAt(F),F===Le&&d+f+p+u!==0&&(0!==d&&(k=d===Y?H:Y),f=p=u=0,Oe++,Le++),d+f+p+u===0){if(F===Le&&(Ae>0&&(Xe=Xe.replace(a,"")),Xe.trim().length>0)){switch(k){case W:case V:case x:case L:case H:break;default:Xe+=s.charAt(F)}k=x}if(1===Ce)switch(k){case M:case j:case x:case Q:case G:case P:case I:case K:Ce=0;case V:case L:case H:case W:break;default:for(Ce=0,Te=F,g=k,F--,k=x;Te<Oe;)switch(s.charCodeAt(Te++)){case H:case L:case x:++F,k=g,Te=Oe;break;case J:Ae>0&&(++F,k=g);case M:Te=Oe}}switch(k){case M:for(Xe=Xe.trim(),g=Xe.charCodeAt(0),N=1,Te=++F;F<Oe;){switch(k=s.charCodeAt(F)){case M:N++;break;case j:N--;break;case Y:switch(v=s.charCodeAt(F+1)){case X:case Y:F=qe(v,F,Le,s)}break;case U:k++;case P:k++;case Q:case G:for(;F++<Le&&s.charCodeAt(F)!==k;);}if(0===N)break;F++}switch(Ke=s.substring(Te,F),g===re&&(g=(Xe=Xe.replace(r,"").trim()).charCodeAt(0)),g){case R:switch(Ae>0&&(Xe=Xe.replace(a,"")),v=Xe.charCodeAt(1)){case pe:case oe:case ce:case q:c=t;break;default:c=Se}if(Ke=Be(t,c,Ke,v,o+1),Te=Ke.length,we>0&&0===Te&&(Te=Xe.length),Ne>0&&(c=He(Se,Xe,Ee),i=ze(xe,Ke,c,t,he,me,Te,v,o,n),Xe=c.join(""),void 0!==i&&0===(Te=(Ke=i.trim()).length)&&(v=0,Ke="")),Te>0)switch(v){case ce:Xe=Xe.replace(S,We);case pe:case oe:case q:Ke=Xe+"{"+Ke+"}";break;case ne:Xe=Xe.replace(m,"$1 $2"+(Me>0?Pe:"")),Ke=Xe+"{"+Ke+"}",Ke=1===ve||2===ve&&Re("@"+Ke,3)?"@"+_+Ke+"@"+Ke:"@"+Ke;break;default:Ke=Xe+Ke,n===fe&&(Je+=Ke,Ke="")}else Ke="";break;default:Ke=Be(t,He(t,Xe,Ee),Ke,n,o+1)}Ge+=Ke,E=0,Ce=0,O=0,Ae=0,Ee=0,T=0,Xe="",Ke="",k=s.charCodeAt(++F);break;case j:case x:if(Xe=(Ae>0?Xe.replace(a,""):Xe).trim(),(Te=Xe.length)>1)switch(0===O&&((g=Xe.charCodeAt(0))===q||g>96&&g<123)&&(Te=(Xe=Xe.replace(" ",":")).length),Ne>0&&void 0!==(i=ze(De,Xe,t,e,he,me,Je.length,n,o,n))&&0===(Te=(Xe=i.trim()).length)&&(Xe="\0\0"),g=Xe.charCodeAt(0),v=Xe.charCodeAt(1),g){case re:break;case R:if(v===ue||v===de){Qe+=Xe+s.charAt(F);break}default:if(Xe.charCodeAt(Te-1)===J)break;Je+=Ve(Xe,g,v,Xe.charCodeAt(2))}E=0,Ce=0,O=0,Ae=0,Ee=0,Xe="",k=s.charCodeAt(++F)}}switch(k){case L:case H:if(d+f+p+u+ye===0)switch(C){case I:case G:case Q:case R:case te:case Z:case X:case ee:case Y:case q:case J:case K:case x:case M:case j:break;default:O>0&&(Ce=1)}d===Y?d=0:ge+E===0&&n!==ne&&Xe.length>0&&(Ae=1,Xe+="\0"),Ne*je>0&&ze(_e,Xe,t,e,he,me,Je.length,n,o,n),me=1,he++;break;case x:case j:if(d+f+p+u===0){me++;break}default:switch(me++,Fe=s.charAt(F),k){case V:case W:if(f+u+d===0)switch(A){case K:case J:case V:case W:Fe="";break;default:k!==W&&(Fe=" ")}break;case re:Fe="\\0";break;case ae:Fe="\\f";break;case se:Fe="\\v";break;case z:f+d+u===0&&ge>0&&(Ee=1,Ae=1,Fe="\f"+Fe);break;case 108:if(f+d+u+be===0&&O>0)switch(F-O){case 2:A===ie&&s.charCodeAt(F-3)===J&&(be=A);case 8:w===le&&(be=w)}break;case J:f+d+u===0&&(O=F);break;case K:d+p+f+u===0&&(Ae=1,Fe+="\r");break;case Q:case G:0===d&&(f=f===k?0:0===f?k:f);break;case U:f+d+p===0&&u++;break;case B:f+d+p===0&&u--;break;case I:f+d+u===0&&p--;break;case P:if(f+d+u===0){if(0===E)switch(2*A+3*w){case 533:break;default:N=0,E=1}p++}break;case R:d+p+f+u+O+T===0&&(T=1);break;case X:case Y:if(f+u+p>0)break;switch(d){case 0:switch(2*k+3*s.charCodeAt(F+1)){case 235:d=Y;break;case 220:Te=F,d=X}break;case X:k===Y&&A===X&&Te+2!==F&&(33===s.charCodeAt(Te+2)&&(Je+=s.substring(Te,F+1)),Fe="",d=0)}}if(0===d){if(ge+f+u+T===0&&n!==ne&&k!==x)switch(k){case K:case te:case Z:case ee:case I:case P:if(0===E){switch(A){case V:case W:case H:case L:Fe+="\0";break;default:Fe="\0"+Fe+(k===K?"":"\0")}Ae=1}else switch(k){case P:O+7===F&&108===A&&(O=0),E=++N;break;case I:0==(E=--N)&&(Ae=1,Fe+="\0")}break;case V:case W:switch(A){case re:case M:case j:case x:case K:case ae:case V:case W:case H:case L:break;default:0===E&&(Ae=1,Fe+="\0")}}Xe+=Fe,k!==W&&k!==V&&(C=k)}}w=A,A=k,F++}if(Te=Je.length,we>0&&0===Te&&0===Ge.length&&0===t[0].length==0&&(n!==oe||1===t.length&&(ge>0?Ie:Ue)===t[0])&&(Te=t.join(",").length+2),Te>0){if(c=0===ge&&n!==ne?function(e){for(var t,r,s=0,n=e.length,o=Array(n);s<n;++s){for(var c=e[s].split(l),i="",u=0,d=0,p=0,f=0,m=c.length;u<m;++u)if(!(0===(d=(r=c[u]).length)&&m>1)){if(p=i.charCodeAt(i.length-1),f=r.charCodeAt(0),t="",0!==u)switch(p){case X:case te:case Z:case ee:case W:case P:break;default:t=" "}switch(f){case z:r=t+Ie;case te:case Z:case ee:case W:case I:case P:break;case U:r=t+r+Ie;break;case J:switch(2*r.charCodeAt(1)+3*r.charCodeAt(2)){case 530:if(ke>0){r=t+r.substring(8,d-1);break}default:(u<1||c[u-1].length<1)&&(r=t+Ie+r)}break;case K:t="";default:r=d>1&&r.indexOf(":")>0?t+r.replace(y,"$1"+Ie+"$2"):t+r+Ie}i+=r}o[s]=i.replace(a,"").trim()}return o}(t):t,Ne>0&&void 0!==(i=ze($e,Je,c,e,he,me,Te,n,o,n))&&0===(Je=i).length)return Qe+Je+Ge;if(Je=c.join(",")+"{"+Je+"}",ve*be!=0){switch(2!==ve||Re(Je,2)||(be=0),be){case le:Je=Je.replace(b,":"+D+"$1")+Je;break;case ie:Je=Je.replace(h,"::"+_+"input-$1")+Je.replace(h,"::"+D+"$1")+Je.replace(h,":"+$+"input-$1")+Je}be=0}}return Qe+Je+Ge}function He(e,t,r){var a=t.trim().split(u),s=a,n=a.length,o=e.length;switch(o){case 0:case 1:for(var c=0,i=0===o?"":e[0]+" ";c<n;++c)s[c]=Le(i,s[c],r,o).trim();break;default:for(var c=0,l=0,s=[];c<n;++c)for(var d=0;d<o;++d)s[l++]=Le(e[d]+" ",a[c],r,o).trim()}return s}function Le(e,t,r,a){var s=t,n=s.charCodeAt(0);switch(n<33&&(n=(s=s.trim()).charCodeAt(0)),n){case z:switch(ge+a){case 0:case 1:if(0===e.trim().length)break;default:return s.replace(d,"$1"+e.trim())}break;case J:switch(s.charCodeAt(1)){case 103:if(ke>0&&ge>0)return s.replace(p,"$1").replace(d,"$1"+Ue);break;default:return e.trim()+s.replace(d,"$1"+e.trim())}default:if(r*ge>0&&s.indexOf("\f")>0)return s.replace(d,(e.charCodeAt(0)===J?"":"$1")+e.trim())}return e+s}function Ve(e,t,r,a){var l,u=0,d=e+";",p=2*t+3*r+4*a;if(944===p)return function(e){var t=e.length,r=e.indexOf(":",9)+1,a=e.substring(0,r).trim(),s=e.substring(r,t-1).trim();switch(e.charCodeAt(9)*Me){case 0:break;case q:if(110!==e.charCodeAt(10))break;default:for(var n=s.split((s="",c)),o=0,r=0,t=n.length;o<t;r=0,++o){for(var l=n[o],u=l.split(i);l=u[r];){var d=l.charCodeAt(0);if(1===Me&&(d>R&&d<90||d>96&&d<123||d===F||d===q&&l.charCodeAt(1)!==q))switch(isNaN(parseFloat(l))+(-1!==l.indexOf("("))){case 1:switch(l){case"infinite":case"alternate":case"backwards":case"running":case"normal":case"forwards":case"both":case"none":case"linear":case"ease":case"ease-in":case"ease-out":case"ease-in-out":case"paused":case"reverse":case"alternate-reverse":case"inherit":case"initial":case"unset":case"step-start":case"step-end":break;default:l+=Pe}}u[r++]=l}s+=(0===o?"":",")+u.join(" ")}}return s=a+s+";",1===ve||2===ve&&Re(s,1)?_+s+s:s}(d);if(0===ve||2===ve&&!Re(d,1))return d;switch(p){case 1015:return 97===d.charCodeAt(10)?_+d+d:d;case 951:return 116===d.charCodeAt(3)?_+d+d:d;case 963:return 110===d.charCodeAt(5)?_+d+d:d;case 1009:if(100!==d.charCodeAt(4))break;case 969:case 942:return _+d+d;case 978:return _+d+D+d+d;case 1019:case 983:return _+d+D+d+$+d+d;case 883:return d.charCodeAt(8)===q?_+d+d:d.indexOf("image-set(",11)>0?d.replace(O,"$1"+_+"$2")+d:d;case 932:if(d.charCodeAt(4)===q)switch(d.charCodeAt(5)){case 103:return _+"box-"+d.replace("-grow","")+_+d+$+d.replace("grow","positive")+d;case 115:return _+d+$+d.replace("shrink","negative")+d;case 98:return _+d+$+d.replace("basis","preferred-size")+d}return _+d+$+d+d;case 964:return _+d+$+"flex-"+d+d;case 1023:if(99!==d.charCodeAt(8))break;return l=d.substring(d.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),_+"box-pack"+l+_+d+$+"flex-pack"+l+d;case 1005:return n.test(d)?d.replace(s,":"+_)+d.replace(s,":"+D)+d:d;case 1e3:switch(l=d.substring(13).trim(),u=l.indexOf("-")+1,l.charCodeAt(0)+l.charCodeAt(u)){case 226:l=d.replace(w,"tb");break;case 232:l=d.replace(w,"tb-rl");break;case 220:l=d.replace(w,"lr");break;default:return d}return _+d+$+l+d;case 1017:if(-1===d.indexOf("sticky",9))return d;case 975:switch(u=(d=e).length-10,l=(33===d.charCodeAt(u)?d.substring(0,u):d).substring(e.indexOf(":",7)+1).trim(),p=l.charCodeAt(0)+(0|l.charCodeAt(7))){case 203:if(l.charCodeAt(8)<111)break;case 115:d=d.replace(l,_+l)+";"+d;break;case 207:case 102:d=d.replace(l,_+(p>102?"inline-":"")+"box")+";"+d.replace(l,_+l)+";"+d.replace(l,$+l+"box")+";"+d}return d+";";case 938:if(d.charCodeAt(5)===q)switch(d.charCodeAt(6)){case 105:return l=d.replace("-items",""),_+d+_+"box-"+l+$+"flex-"+l+d;case 115:return _+d+$+"flex-item-"+d.replace(N,"")+d;default:return _+d+$+"flex-line-pack"+d.replace("align-content","").replace(N,"")+d}break;case 973:case 989:if(d.charCodeAt(3)!==q||122===d.charCodeAt(4))break;case 931:case 953:if(!0===T.test(e))return 115===(l=e.substring(e.indexOf(":")+1)).charCodeAt(0)?Ve(e.replace("stretch","fill-available"),t,r,a).replace(":fill-available",":stretch"):d.replace(l,_+l)+d.replace(l,D+l.replace("fill-",""))+d;break;case 962:if(d=_+d+(102===d.charCodeAt(5)?$+d:"")+d,r+a===211&&105===d.charCodeAt(13)&&d.indexOf("transform",10)>0)return d.substring(0,d.indexOf(";",27)+1).replace(o,"$1"+_+"$2")+d}return d}function Re(e,t){var r=e.indexOf(1===t?":":"{"),a=e.substring(0,3!==t?r:10),s=e.substring(r+1,e.length-1);return Ee(2!==t?a:a.replace(E,"$1"),s,t)}function We(e,t){var r=Ve(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return r!==t+";"?r.replace(C," or ($1)").substring(4):"("+t+")"}function ze(e,t,r,a,s,n,o,c,i,l){for(var u,d=0,p=t;d<Ne;++d)switch(u=Ce[d].call(Xe,e,p,r,a,s,n,o,c,i,l)){case void 0:case!1:case!0:case null:break;default:p=u}if(p!==t)return p}function qe(e,t,r,a){for(var s=t+1;s<r;++s)switch(a.charCodeAt(s)){case Y:if(e===X&&a.charCodeAt(s-1)===X&&t+2!==s)return s+1;break;case H:if(e===Y)return s+1}return s}function Fe(e){for(var t in e){var r=e[t];switch(t){case"keyframe":Me=0|r;break;case"global":ke=0|r;break;case"cascade":ge=0|r;break;case"compress":Ae=0|r;break;case"semicolon":ye=0|r;break;case"preserve":we=0|r;break;case"prefix":Ee=null,r?"function"!=typeof r?ve=1:(ve=2,Ee=r):ve=0}}return Fe}function Xe(t,r){if(void 0!==this&&this.constructor===Xe)return e(t);var s=t,n=s.charCodeAt(0);n<33&&(n=(s=s.trim()).charCodeAt(0)),Me>0&&(Pe=s.replace(f,n===U?"":"-")),n=1,1===ge?Ue=s:Ie=s;var o,c=[Ue];Ne>0&&void 0!==(o=ze(Oe,r,c,c,he,me,0,0,0,0))&&"string"==typeof o&&(r=o);var i=Be(Se,c,r,0,0);return Ne>0&&void 0!==(o=ze(Te,i,c,c,he,me,i.length,0,0,0))&&"string"!=typeof(i=o)&&(n=0),Pe="",Ue="",Ie="",be=0,he=1,me=1,Ae*n==0?i:function(e){return e.replace(a,"").replace(g,"").replace(v,"$1").replace(k,"$1").replace(A," ")}(i)}return Xe.use=function e(t){switch(t){case void 0:case null:Ne=Ce.length=0;break;default:if("function"==typeof t)Ce[Ne++]=t;else if("object"==typeof t)for(var r=0,a=t.length;r<a;++r)e(t[r]);else je=0|!!t}return e},Xe.set=Fe,void 0!==t&&Fe(t),Xe}(null)});function processStyle(e,t){if(e)return stylis(`.${e}`,t);const r=stylis("",t);return r.substr(1,r.length-2)}function getClassNewName(e,t){return`${e}--${t}`}function getClassesRules(e,t){if(!t)return null;return Object.keys(t).reduce((r,a)=>{return`${r}${processStyle(getClassNewName(a,e),t[a])}`},"")}function getStyles(e={}){return Object.keys(e).reduce((t,r)=>{const a=e[r];return{...t,[r]:"function"==typeof a?(...e)=>processStyle(null,a(...e)):processStyle(null,a)}},{})}function getFinalProps(e){const t=e.props||{},{store:r,componentDef:a,processedStyles:s,utils:n}=e;return{props:t,state:a.state?a.state(t,r):{},actions:a.actions?a.actions(t,r):{},styles:s,classes:e=>getClassNewName(e,a.id),utils:n}}function getStore(e,t){return{alerts:e.objects.alerts,addAlert:e.methods.alertOn,check:e.methods.check,toggle:e.methods.toggle,set:e.methods.set,setItem:e.methods.setItem,call:e.process.call,callServer:e.methods.callServer,get:e.methods.get(t),route:e.router.route,utils:{get:e.utils.get,uid:e.utils.uid,localize:e.utils.localize(e.objects.observables.language)},db:e.db?e.db.query:()=>void 0}}var createHoc=(e,t,r)=>{const{isProduction:a}=t;if(r&&!a){console.log("isProduction",a),document.getElementById("component-styles").innerText=""}return t=>{t.id||(t.id=1e3),e.render.registerComponent(t);const s=getClassesRules(t.id,t.classes);registerStyles(t.id,s,r,a);const n=getStore(e),o=n.utils,c=getStyles(t.styles);return function(r,a){!e.objects.flags.IS_MOUNTED&&t.mounted&&e.methods.on("MOUNTED",()=>{t.mounted(r,n)});const s=getFinalProps({props:r,utils:o,store:n,componentDef:t,processedStyles:c});return t.render(s,a)}}};const isSvgElement=e=>["circle","defs","ellipse","g","line","path","polygon","polyline","rect","svg","text","use"].includes(e),isSpecialProp=e=>["__innerHTML"].includes(e),appendText=(e,t)=>{const r=document.createTextNode(t);e.appendChild(r)},addSpecialProp=(e,t,r)=>{"__innerHTML"===t&&(e.innerHTML=r)},appendArray=(e,t)=>{t.forEach(t=>{Array.isArray(t)?appendArray(e,t):t instanceof window.Element?e.appendChild(t):"string"==typeof t&&appendText(e,t)})};var utils$1={isSvgElement:isSvgElement,isSpecialProp:isSpecialProp,addSpecialProp:addSpecialProp,appendText:appendText,appendArray:appendArray};const NS="http://www.w3.org/2000/svg";var createHDom=(e,t)=>(r,a={},...s)=>{if("function"==typeof r)return a?r({...a},s):r();const n=utils$1.isSvgElement(r)?document.createElementNS(NS,r):document.createElement(r);return s instanceof window.Element?n.appendChild(s):"string"==typeof s?utils$1.appendText(n,s):Array.isArray(s)&&utils$1.appendArray(n,s),a&&Object.keys(a).forEach(s=>{const o=a[s];s.startsWith("on")&&(e.render.Events[s]=!0),"style"!==s||t?"class"===s?n.className=o:s in n?o&&(n[s]=o):utils$1.isSpecialProp(s)?utils$1.addSpecialProp(n,s,o):s.startsWith("data-")?n.setAttribute(s,o):console.warn(`${s} is not a valid property of a <${r}>`):n.setAttribute("data-style",o)}),n};function createScript(e,t){if(document.getElementById(e))return;const r=document.createElement("script");r.id=e,r.src=t,r.async=1,r.defer=1,document.body.appendChild(r)}var utils$2={prepareComponents(e,t,r,a){let s=a;Object.keys(r).forEach(a=>{const n=r[a];e.ui[t][a]=n(e,s),s++})}};function createClient(e,t){const{Store:r,lib:a,components:s,fragments:n,pages:o,appData:c}=e,i={h:createHDom(r,t),ui:{components:{},fragments:{},pages:{}},createScript:createScript};return i.hoc=createHoc(r,c,t),i.lib=a,utils$2.prepareComponents(i,"components",s,4e3),utils$2.prepareComponents(i,"fragments",n,3e3),utils$2.prepareComponents(i,"pages",o,2e3),i}var init=(e,t=!1)=>{const{store:r,lib:a,rootComponent:s,rootNodeId:n,components:o={},fragments:c={},pages:i={}}=e,l=createStore({...r,rootNodeId:n,rootComponent:s});t&&(window.Store=l);const u=t?window[globals.WINDOW_APP_DATA]:null;console.log("appData",u);const d=createClient({Store:l,lib:a,components:o,fragments:c,pages:i,appData:u},t);return t&&(window.onload=(()=>{l.render.startApp({appData:u,client:d})})),d};const client={init:init};export{client};